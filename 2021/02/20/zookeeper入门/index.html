<!DOCTYPE html><html style="display:none" lang="zh"><head><meta charset="utf-8"><script>window.materialVersion="1.5.2",window.oldVersion=["codestartv1","1.3.4","1.4.0","1.4.0b1","1.5.0"]</script><meta http-equiv="x-dns-prefetch-control" content="on"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>zookeeper入门 | 小明的博客</title><link rel="icon shortcut" type="image/ico" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="format-detection" content="telephone=no"><meta name="description" itemprop="description" content=""><meta name="keywords" content=",Zookeeper"><meta name="theme-color" content="#0097A7"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]--><script>window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}},lsloader.removeLS=function(e){try{localStorage.removeItem(e)}catch(e){}},lsloader.setLS=function(e,t){try{localStorage.setItem(e,t)}catch(e){}},lsloader.getLS=function(e){var t="";try{t=localStorage.getItem(e)}catch(e){t=""}return t},versionString="/*"+(window.materialVersion||"unknownVersion")+"*/",lsloader.clean=function(){try{for(var e=[],t=0;t<localStorage.length;t++)e.push(localStorage.key(t));e.forEach(function(e){var n=lsloader.getLS(e);window.oldVersion&&window.oldVersion.reduce(function(e,t){return e||-1!==n.indexOf("/*"+t+"*/")},!1)&&lsloader.removeLS(e)})}catch(e){}},lsloader.clean(),lsloader.load=function(e,t,n,s){var a;if("boolean"==typeof n&&(s=n,n=void 0),s=s||!1,n=n||function(){},(a=this.getLS(e))&&-1===a.indexOf(versionString))return this.removeLS(e),void this.requestResource(e,t,n,s);if(a){if(a.split(versionString)[0]!=t)return console.log("reload:"+t),this.removeLS(e),void this.requestResource(e,t,n,s);a=a.split(versionString)[1],s?(this.jsRunSequence.push({name:e,code:a}),this.runjs(t,e,a)):(document.getElementById(e).appendChild(document.createTextNode(a)),n())}else this.requestResource(e,t,n,s)},lsloader.requestResource=function(t,n,e,s){var a=this;s?this.iojs(n,t,function(e,t,n){a.setLS(t,e+versionString+n),a.runjs(e,t,n)}):this.iocss(n,t,function(e){document.getElementById(t).appendChild(document.createTextNode(e)),a.setLS(t,n+versionString+e)},e)},lsloader.iojs=function(t,n,e){var s=this;s.jsRunSequence.push({name:n,code:""});try{var a=new XMLHttpRequest;a.open("get",t,!0),a.onreadystatechange=function(){if(4==a.readyState){if((200<=a.status&&a.status<300||304==a.status)&&""!=a.response)return void e(t,n,a.response);s.jsfallback(t,n)}},a.send(null)}catch(e){s.jsfallback(t,n)}},lsloader.iocss=function(t,n,e,s){var a=this;try{var o=new XMLHttpRequest;o.open("get",t,!0),o.onreadystatechange=function(){if(4==o.readyState){if((200<=o.status&&o.status<300||304==o.status)&&""!=o.response)return e(o.response),void s();a.cssfallback(t,n,s)}},o.send(null)}catch(e){a.cssfallback(t,n,s)}},lsloader.iofonts=function(t,n,e,s){var a=this;try{var o=new XMLHttpRequest;o.open("get",t,!0),o.onreadystatechange=function(){if(4==o.readyState){if((200<=o.status&&o.status<300||304==o.status)&&""!=o.response)return e(o.response),void s();a.cssfallback(t,n,s)}},o.send(null)}catch(e){a.cssfallback(t,n,s)}},lsloader.runjs=function(e,t,n){if(t&&n)for(var s in this.jsRunSequence)this.jsRunSequence[s].name==t&&(this.jsRunSequence[s].code=n);var a,o;this.jsRunSequence[0]&&this.jsRunSequence[0].code&&"failed"!=this.jsRunSequence[0].status?((o=document.createElement("script")).appendChild(document.createTextNode(this.jsRunSequence[0].code)),o.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(o),this.jsRunSequence.shift(),0<this.jsRunSequence.length&&this.runjs()):this.jsRunSequence[0]&&"failed"==this.jsRunSequence[0].status&&(a=this,(o=document.createElement("script")).src=this.jsRunSequence[0].path,o.type="text/javascript",this.jsRunSequence[0].status="loading",o.onload=function(){a.jsRunSequence.shift(),0<a.jsRunSequence.length&&a.runjs()},document.body.appendChild(o))},lsloader.tagLoad=function(e,t){this.jsRunSequence.push({name:t,code:"",path:e,status:"failed"}),this.runjs()},lsloader.jsfallback=function(e,t){if(!this.jsnamemap[t]){for(var n in this.jsnamemap[t]=t,this.jsRunSequence)this.jsRunSequence[n].name==t&&(this.jsRunSequence[n].code="",this.jsRunSequence[n].status="failed",this.jsRunSequence[n].path=e);this.runjs()}},lsloader.cssfallback=function(e,t,n){var s,a;this.cssnamemap[t]||(this.cssnamemap[t]=1,(s=document.createElement("link")).type="text/css",s.href=e,s.rel="stylesheet",s.onload=s.onerror=n,(a=document.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a))},lsloader.runInlineScript=function(e,t){var n=document.getElementById(t).innerText;this.jsRunSequence.push({name:e,code:n}),this.runjs()}</script><script>function Queue(){this.dataStore=[],this.offer=function(e){this.debug&&console.log("Offered a Queued Function.");"function"==typeof e?this.dataStore.push(e):console.log("You must offer a function.")},this.poll=function(){this.debug&&console.log("Polled a Queued Function.");return this.dataStore.shift()},this.execNext=function(){var e=this.poll();void 0!==e&&(this.debug&&console.log("Run a Queued Function."),e())},this.debug=!1,this.startDebug=function(){this.debug=!0}}var queue=new Queue</script><style id="material_css"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style id="style_css"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("style_css","/css/style.min.css?o/QgWoDY1MxSOUl1qixLgQ==",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style id="prettify_css"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style id="prettify_theme"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("prettify_theme","/css/prettify/tomorrow-night-bright.min.css?8VgE6WqhtH02IzxbAnMvKA==",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style>body,html{font-family:Roboto,"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif;overflow-x:hidden!important}code{font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace}a{color:#00838f}#scheme-Paradox .hot_tags-count,#scheme-Paradox .sidebar-colored .sidebar-badge,#scheme-Paradox .sidebar-colored .sidebar-header,#scheme-Paradox .sidebar_archives-count,#search-form-label:after,#search-label,.mdl-card__media{background-color:#0097a7!important}#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus,#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover{color:#0097a7!important}#ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a,#post_entry-right-info,.sidebar-colored .sidebar-nav li:hover>a,.sidebar-colored .sidebar-nav li:hover>a i,.sidebar-colored .sidebar-nav li>a:focus i,.sidebar-colored .sidebar-nav li>a:hover,.sidebar-colored .sidebar-nav li>a:hover i,.sidebar-colored .sidebar-nav>.open>a,.sidebar-colored .sidebar-nav>.open>a:focus,.sidebar-colored .sidebar-nav>.open>a:hover{color:#0097a7!important}.toTop{background:#757575!important}.material-layout .material-index>.material-nav,.material-layout .material-post>.material-nav,.material-nav a{color:#757575}#scheme-Paradox .MD-burger-layer{background-color:#757575}#scheme-Paradox #post-toc-trigger-btn{color:#757575}.post-toc a:hover{color:#00838f;text-decoration:underline}</style><style>body{background-color:#f5f5f5}#scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{background-color:#fff}</style><style>.fade{transition:all .8s linear;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0);opacity:1}.fade.out{opacity:0}</style><style>@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.eot);src:local('Roboto'),local('Roboto-Normal'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.eot?#iefix) format('embedded-opentype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.woff2) format('woff2'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.woff) format('woff'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.ttf) format('truetype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.svg#Roboto) format('svg')}@font-face{font-family:Roboto;font-style:normal;font-weight:regular;src:url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.eot);src:local('Roboto'),local('Roboto-Normal'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.eot?#iefix) format('embedded-opentype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.woff2) format('woff2'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.woff) format('woff'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.ttf) format('truetype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.svg#Roboto) format('svg')}@font-face{font-family:Roboto;font-style:normal;font-weight:500;src:url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.eot);src:local('Roboto'),local('Roboto-Normal'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.eot?#iefix) format('embedded-opentype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.woff2) format('woff2'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.woff) format('woff'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.ttf) format('truetype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.svg#Roboto) format('svg')}</style><style id="material_icons"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("material_icons","/css/material-icons.css?OHGA+ZW1WnzZodD183zSGQ==",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><script>lsloader.load("jq_js","https://lib.baomitu.com/jquery/2.2.0/jquery.min.js",!0)</script><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="小明的博客"><meta name="msapplication-starturl" content="https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/"><meta name="msapplication-navbutton-color" content="#0097A7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="小明的博客"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/img/favicon.png"><meta property="og:url" content="https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/"><meta property="og:type" content="blog"><meta property="og:title" content="zookeeper入门 | 小明的博客"><meta property="og:image" content="/img/favicon.png"><meta property="og:description" content=""><meta property="og:article:tag" content="Zookeeper"><meta property="article:published_time" content="Sat Feb 20 2021 14:16:32 GMT+0000"><meta property="article:modified_time" content="Sun Nov 19 2023 14:35:52 GMT+0000"><meta name="twitter:card" content="summary_large_image"><link rel="canonical" href="https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/index.html"><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/index.html",
    "headline": "zookeeper入门",
    "datePublished": "Sat Feb 20 2021 14:16:32 GMT+0000",
    "dateModified": "Sun Nov 19 2023 14:35:52 GMT+0000",
    "author": {
        "@type": "Person",
        "name": "小明",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "Hi, nice to meet you"
    },
    "publisher": {
        "@type": "Organization",
        "name": "小明的博客",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",Zookeeper",
    "description": "",
}</script><meta name="generator" content="Hexo 5.4.2"></head><body id="scheme-Paradox" class="lazy"><div class="material-layout mdl-js-layout has-drawer is-upgraded"><main class="material-layout__content" id="main"><div id="top"></div><button class="MD-burger-icon sidebar-toggle"><span class="MD-burger-layer"></span></button> <button id="post-toc-trigger-btn" class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">format_list_numbered</i></button><ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh;overflow-y:scroll"><ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="post-toc-number">1.</span> <span class="post-toc-text">一、概述</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1-%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.1 常见应用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2-%E7%89%B9%E6%80%A7"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">1.2 特性</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-3-%E8%A7%92%E8%89%B2"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">1.3 角色</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-3-1-leader"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">1.3.1 leader</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-3-2-follower"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">1.3.2 follower</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-3-3-Observer"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">1.3.3 Observer</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BA%8C%E3%80%81%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="post-toc-number">2.</span> <span class="post-toc-text">二、集群搭建</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-%E9%80%9A%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">2.1 通用步骤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.2 配置文件修改</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-%E5%90%AF%E5%8A%A8"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">2.3 启动</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-4-%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">2.4 查看状态</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-5-%E5%85%B3%E9%97%AD"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">2.5 关闭</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="post-toc-number">3.</span> <span class="post-toc-text">三、数据模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-Znode"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">3.1 Znode</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2-Znode%E7%B1%BB%E5%9E%8B"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">3.2 Znode类型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3.3 节点属性</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9B%9B%E3%80%81Zookeeper%E9%80%89%E4%B8%BE"><span class="post-toc-number">4.</span> <span class="post-toc-text">四、Zookeeper选举</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%AF%E5%8A%A8"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">服务器初始化启动</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%9C%9F%E9%97%B4%E6%97%A0%E6%B3%95%E5%92%8CLeader%E4%BF%9D%E6%8C%81%E8%BF%9E%E6%8E%A5"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">服务器运行期间无法和Leader保持连接</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Leader%E9%80%89%E4%B8%BE%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">Leader选举算法分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8A%95%E7%A5%A8"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">第一次投票</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%8F%98%E6%9B%B4%E6%8A%95%E7%A5%A8"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">变更投票</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%80%89%E4%B8%BE%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">选举实现细节</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">服务器状态</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%8A%95%E7%A5%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">投票数据结构</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#QuorumCnxManager%EF%BC%88%E7%BD%91%E7%BB%9CI-O%EF%BC%89"><span class="post-toc-number">4.4.3.</span> <span class="post-toc-text">QuorumCnxManager（网络I&#x2F;O）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="post-toc-number">4.4.3.1.</span> <span class="post-toc-text">消息队列</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="post-toc-number">4.4.3.2.</span> <span class="post-toc-text">建立连接</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6%E4%B8%8E%E5%8F%91%E9%80%81"><span class="post-toc-number">4.4.3.3.</span> <span class="post-toc-text">消息接收与发送</span></a></li></ol></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#FastLeaderElection%EF%BC%9A%E9%80%89%E4%B8%BE%E7%AE%97%E6%B3%95%E6%A0%B8%E5%BF%83"><span class="post-toc-number">4.4.4.</span> <span class="post-toc-text">FastLeaderElection：选举算法核心</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E9%80%89%E7%A5%A8%E7%AE%A1%E7%90%86"><span class="post-toc-number">4.4.4.1.</span> <span class="post-toc-text">选票管理</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BA%94%E3%80%81%E8%A1%A5%E5%85%85"><span class="post-toc-number">5.</span> <span class="post-toc-text">五、补充</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ZXID"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">ZXID</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ZXID%E5%8F%98%E5%8C%96"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">ZXID变化</span></a></li></ol></li></ol></ul><div class="material-post_container"><div class="material-post mdl-grid"><div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50"><script type="text/ls-javascript" id="post-thumbnail-script">var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');</script><p class="article-headline-p">zookeeper入门</p></div><div class="mdl-color-text--grey-700 mdl-card__supporting-text meta"><div id="author-avatar"><img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"></div><div><strong>小明</strong> <span>2月 20, 2021</span></div><div class="section-spacer"></div><button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">bookmark</i> <span class="visuallyhidden">bookmark</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button"><li class="mdl-menu__item"><a class="post_tag-none-link" href="/tags/Zookeeper/" rel="tag">Zookeeper</a></li></ul><button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">share</i> <span class="visuallyhidden">share</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button"><a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=zookeeper入门&url=https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/index.html&pic=https://huanming.org/img/favicon.png&searchPic=false&style=simple" target="_blank"><li class="mdl-menu__item">分享到微博</li></a><a class="post_share-link" href="https://twitter.com/intent/tweet?text=zookeeper入门&url=https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/index.html&via=小明" target="_blank"><li class="mdl-menu__item">分享到 Twitter</li></a><a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/index.html" target="_blank"><li class="mdl-menu__item">分享到 Facebook</li></a><a class="post_share-link" href="https://plus.google.com/share?url=https://huanming.org/2021/02/20/zookeeper%E5%85%A5%E9%97%A8/index.html" target="_blank"><li class="mdl-menu__item">分享到 Google+</li></a></ul></div><div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out"><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>zookeeper是一个分布式协调服务框架，主要用来解决分布式集群中引用系统的一致性问题，例如避免同时操作同一数据避免脏读。</p><p>本质是一个 <strong>分布式的</strong> <strong>小文件</strong> （如几k到几十k）存储系统。提供基于类似文件系统的目录树方式的数据存储，并且可以对树中的节点进行有效管理，从而维护和监控数据的状态变化。通过监控数据状态的变化，从而达到基于数据的集群管理。</p><h4 id="1-1-常见应用"><a href="#1-1-常见应用" class="headerlink" title="1.1 常见应用"></a>1.1 常见应用</h4><ul><li><p>统一命名服务</p></li><li><p>分布式配置管理</p></li><li><p>分布式消息队列</p></li><li><p>分布式锁</p></li><li><p>分布式协调</p></li></ul><h4 id="1-2-特性"><a href="#1-2-特性" class="headerlink" title="1.2 特性"></a>1.2 特性</h4><ul><li><p>全局数据一致性： 每个server保存一份相同的数据副本，client无论连哪个server，展示的数据都是一样的。最重要的特性。</p></li><li><p>可靠性：如果消息（crud）被一台服务器接受，那么将被所有的服务器接受。为了保证全局数据一致性而产生。</p></li><li><p>顺序性：保证全局有序和偏序两种：全局有序指如果在一台服务器上消息a在消息b前发布，则所有服务器消息a都将在消息b前发布；偏序是指如果一个消息b在消息a后被同一发布者发布，a必将排在b前面。即统一发布者发布顺序性。为了保证全局数据一致性而产生。</p></li><li><p>数据更新原子性：一次数据更新要么成功（半数以上节点成功），要么失败，不存在中间状态。在半数成功之后其他节点直接同步保全局数据一致性。</p></li><li><p>实时性：zookeeper保证客户端将在一定时间间隔内获得服务器的更新信息，或者服务器失效的信息。</p></li></ul><h4 id="1-3-角色"><a href="#1-3-角色" class="headerlink" title="1.3 角色"></a>1.3 角色</h4><h5 id="1-3-1-leader"><a href="#1-3-1-leader" class="headerlink" title="1.3.1 leader"></a>1.3.1 leader</h5><p>zookeeper句群工作的核心，一个集群有且只有一个leader。事务请求（写操作）的唯一调度和处理者。保证集群事务处理的顺序性，集群内部各个服务器的调度者。</p><p>对于cud等写操作请求，需统一转发给leader处理，leader决定编号、执行操作，这个过程为一个事务。</p><h5 id="1-3-2-follower"><a href="#1-3-2-follower" class="headerlink" title="1.3.2 follower"></a>1.3.2 follower</h5><p>处理客户端的非事务请求（读操作），转发事务请求给leader。参与集群leader选举投票。</p><h5 id="1-3-3-Observer"><a href="#1-3-3-Observer" class="headerlink" title="1.3.3 Observer"></a>1.3.3 Observer</h5><p>访问量较大时可新增观察者角色。观察者观察zookeeper集群的最新状态变化并将这些状态同步过来，其对于非事务请求可以独立处理，对于事务请求将转发给leader处理。</p><p>不参与任何形式的投票，只提供非事务服务，通常用于在不影响集群事务处理能力的情况下提升集群的的非事务处理能力。</p><h3 id="二、集群搭建"><a href="#二、集群搭建" class="headerlink" title="二、集群搭建"></a>二、集群搭建</h3><h4 id="2-1-通用步骤"><a href="#2-1-通用步骤" class="headerlink" title="2.1 通用步骤"></a>2.1 通用步骤</h4><p>通常选择2n + 1台服务器组成。因为leader选举使用Paxos算法实现，只要半数支持即可，所以服务器数量一般为奇数。</p><ul><li><p>检查各个服务器时间是否同步，检测防火墙是否关闭。</p></li><li><p>配置主机名称到ip地址映射配置。</p></li><li><p>修改zookeeper配置文件。</p></li><li><p>远程复制分发安装文件（将上述配置完成的zk分发到不同的主机上）。</p></li><li><p>修改myid。</p></li><li><p>启动zookeeper集群。</p></li></ul><h4 id="2-2-配置文件修改"><a href="#2-2-配置文件修改" class="headerlink" title="2.2 配置文件修改"></a>2.2 配置文件修改</h4><p>添加数据路径配置</p><pre><code class="properties">dataDir=/data/directory/
</code></pre><p>添加集群数据：</p><pre><code class="properties"> # server.1 表示服务器的id是1
 # s2 表示主机名
 # 2888 3888分别表示心跳端口和选举端口
 # 行末不能有空格，如果行末有空格将会读取失败
 # s1不能随便设置成自定义符号，否则会建立连接
 # 如果s1设置为ip那么当前服务器的配置配置文件的ip应该设置为0.0.0.0
server.1=s1:2888:3888
server.2=s2:2888:3888 
server.3=s3:2888:3888 
</code></pre><p>在<code>/data/directory</code>文件夹中新建myid文件，文件内容为服务器的id号，如：server.1的myid文件为1。</p><pre><code class="shell">touch myid &amp;&amp; echo 1 &gt; /data/directory/myid
</code></pre><p>需要使用观察者，在对应节点配置文件中添加如下配置：</p><pre><code class="properties">peerType=observer
</code></pre><p>其次，在配置文件制定哪些节点为观察者，如：</p><pre><code class="properties">server.1=localhost:2181:3181:observer
</code></pre><h4 id="2-3-启动"><a href="#2-3-启动" class="headerlink" title="2.3 启动"></a>2.3 启动</h4><p>使用安装目录下的<code>bin/zkServer.sh</code>启动。</p><pre><code class="shell"># 在有一半的节点启动完之后几可使用status查看状态
bash bin/zkServer.sh start
</code></pre><h4 id="2-4-查看状态"><a href="#2-4-查看状态" class="headerlink" title="2.4 查看状态"></a>2.4 查看状态</h4><pre><code class="shell"> bash bin/zkServer.sh status
</code></pre><h4 id="2-5-关闭"><a href="#2-5-关闭" class="headerlink" title="2.5 关闭"></a>2.5 关闭</h4><pre><code class="shell"> bash bin/zkServer.sh stop
</code></pre><h3 id="三、数据模型"><a href="#三、数据模型" class="headerlink" title="三、数据模型"></a>三、数据模型</h3><h4 id="3-1-Znode"><a href="#3-1-Znode" class="headerlink" title="3.1 Znode"></a>3.1 Znode</h4><p>zookeeper的数据模型，在结构上和标准文件系统非常相似，拥有一个层次的命名空间，都是采用树形层次结构，Zookeeper中树的每个节点称为ZNode，和文件系统的目录树一样，zookeeper树中的每个节点可以有子节点。ZNode具有以下特点：</p><ul><li><p>Znode兼具文件和目录的特点。既像文件一样维护数据、元信息、ACL、时间戳等数据结构。又像目录一样作为路径标识的一部分，并可以具有子ZNode。在权限允许的情况下，用户可对ZNode进行crud。</p></li><li><p>Znode具有原子性。读操作将获取与节点有关的所有数据，写操作也将替换掉所有节点的所有数据。每个节点有自己的ACL（访问控制列表），规定了用户的权限，限定了特定用户对目标节点可以执行的操作。</p></li><li><p>Znode存储大小有限制。Zookeeper可以关联一些数据，但是并没有设计为常规的数据库或者大数据存储，相反，它用来管理调度数据，如分布式应用的配置文件、状态信息、汇集位置等。这些数据共同的特性就是都是很小的数据，大小都是以KB为单位。Zookeeper的服务器和客户端都被严格设计为严格检查并限制每个Znode的数据大小最大为1MB。但是常规使用中应远小于它。</p></li><li><p>Znode通过路径引用。如同Unix的文件路径，但是必须是绝对路径，即以<strong>斜杠字符</strong>开头，除此之外，路径必须是唯一的，一个路径只能有一个表示（类似哈夫曼编码，但是哈夫曼编码是二进制的）。路径由Unicode编码，并且有一定限制，“/zookeeper”用于保存管理信息，例如配额信息。</p></li></ul><p>Znode由三部分组成：</p><ol><li>stat：状态信息。描述Znode的版本、权限等信息。</li><li>data：与该Znode关联的数据。</li><li>children：该Znode下的子节点。</li></ol><h4 id="3-2-Znode类型"><a href="#3-2-Znode类型" class="headerlink" title="3.2 Znode类型"></a>3.2 Znode类型</h4><p>节点在创建时生命周期即确定，且不能被改变，根据生命周期分为：</p><ul><li><p>临时节点。该节点生命周期依赖于创建它的会话，一旦会话结束，临时节点将被自动删除，也可以手动删除。临时节点不允许有子节点。</p></li><li><p>永久节点。该节点生命周期不依赖于会话，且只有客户端显式删除时才会被删除。</p></li></ul><p>Znode具有序列化特性。如果在创建的时候指定-s参数，则具有序列化特性，在创建完成之后Znode的名字还会自动追加一个不断增加的序列号，该序列号对于当前节点的父节点来说是唯一的，这样便能够记录每个子节点的创建先后顺序。格式为“%10d”（10位数字，不够补零，如0000000001）。<br>举例：</p><pre><code class="shell">create -s /a aValue
# Created /a0000000001
create -s /b bValue
# Created /b0000000002
get /a
# org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /a
ls /
# [a0000000001, b0000000002, dubbo, zookeeper]
get /a0000000001
# aValue
</code></pre><p>所以Znode又可以分为：</p><table><thead><tr><th>Znode名字</th><th>持久化</th><th>序列化</th></tr></thead><tbody><tr><td>PERSISTENT 永久节点</td><td>是</td><td>否</td></tr><tr><td>EPHEMERAL 临时节点</td><td>否</td><td>否</td></tr><tr><td>PERSISTENT_SEQUENTIAL 永久序列化节点</td><td>是</td><td>是</td></tr><tr><td>EPHEMERAL_SEQUENTIAL 临时序列化节点</td><td>否</td><td>否</td></tr></tbody></table><h4 id="3-3-节点属性"><a href="#3-3-节点属性" class="headerlink" title="3.3 节点属性"></a>3.3 节点属性</h4><p>通过<code>get</code>或者<code>stat</code>命令可查看Znode的属性。</p><pre><code class="shell">get /a0000000001
# aValue
# cZxid = 0x16d
# ctime = Tue Feb 23 10:58:08 CST 2021
# mZxid = 0x16d
# mtime = Tue Feb 23 10:58:08 CST 2021
# pZxid = 0x16d
# cversion = 0
# dataVersion = 0
# aclVersion = 0
# ephemeralOwner = 0x0
# dataLength = 6
# numChildren = 0
</code></pre><p>dataVersion: 数据版本号，每次对节点进行set操作dataVersion都会加1（即使set前后值一致），有效避免了数据出现的先后顺序问题。<br>cversion：子节点的版本号。当当前节点的子节点发生变化时，cversion的值加1。<br>aclVersion：acl的版本号。<br>cZxid：当前节点创建的事务id。<br>mZxid：当前节点被修改的事务id。每次对当前节点修改都会更新mZxid。</p><blockquote><blockquote><p>对于zk来说，每次的变化都会产生唯一的事务id，zxid（Zookeeper Transaction Id）。通过zxid可以确定更新操作的先后顺序。如zxid1 &lt; zxid2，说明zxid1先于zxid2发生。zxid对于整个zookeeper都是唯一的，即使操作的是不同节点。</p></blockquote></blockquote><p>pZxid：该节点的子节点列表最后一次被修改时的时间，子节点内容变更不会变更pZxid // TODO 存疑</p><p>ctime: 节点创建的时间戳。<br>mtime：节点最后更新的时间戳。<br>ephemeralOwner：如果节点为永久节点，取值0。临时节点绑定对应的session id（会话id）。</p><blockquote><blockquote><p>在client和server通信前，首先要建立连接，每个连接可以取得对应的session id，连接建立后如果发生连接超时、授权失败或显式关闭，连接将处于CLOSED状态，此时session结束。</p></blockquote></blockquote><h3 id="四、Zookeeper选举"><a href="#四、Zookeeper选举" class="headerlink" title="四、Zookeeper选举"></a>四、Zookeeper选举</h3><p>Leader选举是保证分布式数据一致性的关键所在。当Zookeeper集群中的一台服务器出现以下两种情况之一时，需要进入Leader选举。</p><p>　　(1) 服务器初始化启动。</p><p>　　(2) 服务器运行期间无法和Leader保持连接。</p><h4 id="服务器初始化启动"><a href="#服务器初始化启动" class="headerlink" title="服务器初始化启动"></a>服务器初始化启动</h4><p>若进行Leader选举，则至少需要两台机器，这里选取3台机器组成的服务器集群为例。在集群初始化阶段，当有一台服务器Server1启动时，其单独无法进行和完成Leader选举，当第二台服务器Server2启动时，此时两台机器可以相互通信，每台机器都试图找到Leader，于是进入Leader选举过程。即超过半数机器启动完成并相互通信之后开始选举，选举过程如下：</p><ol><li><p>每个Server发出一个投票。由于是初始情况，Server1和Server2都会将自己作为Leader服务器来进行投票，每次投票会包含所推举的服务器的myid和ZXID，使用(myid, ZXID)来表示，此时Server1的投票为(1, 0)，Server2的投票为(2, 0)，然后各自将这个投票发给集群中其他机器。</p></li><li><p>接受来自各个服务器的投票。集群的每个服务器收到投票后，首先判断该投票的有效性，如检查是否是本轮投票、是否来自LOOKING状态的服务器。</p></li><li><p>处理投票。针对每一个投票，服务器都需要将别人的投票和自己的投票进行PK，PK规则如下：</p><ul><li><p>优先检查ZXID。ZXID比较大的服务器优先作为Leader。</p></li><li><p>如果ZXID相同，那么就比较myid。myid较大的服务器作为Leader服务器。</p></li></ul></li></ol><p>对于Server1而言，它的投票是(1, 0)，接收Server2的投票为(2, 0)，首先会比较两者的ZXID，均为0，再比较myid，此时Server2的myid最大，于是更新自己的投票为(2, 0)，然后重新投票，对于Server2而言，其无须更新自己的投票，只是再次向集群中所有机器发出上一次投票信息即可。</p><ol start="4"><li><p>统计投票。每次投票后，服务器都会统计投票信息，判断是否已经有过半机器接受到相同的投票信息，对于Server1、Server2而言，都统计出集群中已经有两台机器接受了(2, 0)的投票信息，此时便认为已经选出了Leader。</p></li><li><p>改变服务器状态。一旦确定了Leader，每个服务器就会更新自己的状态，如果是Follower，那么就变更为FOLLOWING，如果是Leader，就变更为LEADING。</p></li></ol><h4 id="服务器运行期间无法和Leader保持连接"><a href="#服务器运行期间无法和Leader保持连接" class="headerlink" title="服务器运行期间无法和Leader保持连接"></a>服务器运行期间无法和Leader保持连接</h4><p>在Zookeeper运行期间，Leader与非Leader服务器各司其职，即便当有非Leader服务器宕机或新加入，此时也不会影响Leader，但是一旦Leader服务器挂了，那么整个集群将暂停对外服务（此时服务不可用，所以丧失了CAP理论中的A），进入新一轮Leader选举，其过程和启动时期的Leader选举过程基本一致。假设正在运行的有Server1、Server2、Server3三台服务器，当前Leader是Server2，若某一时刻Leader挂了，此时便开始Leader选举。选举过程如下</p><ol><li><p><strong>变更状态</strong>。Leader挂后，余下的非Observer服务器都会将自己的服务器状态变更为LOOKING，然后开始进入Leader选举过程。</p></li><li><p><strong>每个Server会发出一个投票</strong>。在运行期间，每个服务器上的ZXID可能不同，此时假定Server1的ZXID为123，Server3的ZXID为122；在第一轮投票中，Server1和Server3都会投自己，产生投票(1, 123)，(3, 122)，然后各自将投票发送给集群中所有机器。</p></li><li><p><strong>接收来自各个服务器的投票</strong>。与启动时过程相同。</p></li><li><p><strong>处理投票</strong>。与启动时过程相同。</p></li><li><p><strong>统计投票</strong>。与启动时过程相同，此时，Server1将会成为Leader。</p></li><li><p><strong>改变服务器的状态</strong>。与启动时过程相同。</p></li></ol><h4 id="Leader选举算法分析"><a href="#Leader选举算法分析" class="headerlink" title="Leader选举算法分析"></a>Leader选举算法分析</h4><p>在3.4.0后的Zookeeper的版本只保留了TCP版本的FastLeaderElection选举算法。当一台机器进入Leader选举时，当前集群可能会处于以下两种状态：</p><ol><li>集群中已经存在Leader。</li><li>集群中不存在Leader。</li></ol><p>对于集群中已经存在Leader而言，此种情况一般都是某台机器启动得较晚，在其启动之前，集群已经在正常工作，对这种情况，该机器试图去选举Leader时，会被告知当前服务器的Leader信息，对于该机器而言，仅仅需要和Leader机器建立起连接，并进行状态同步即可。而在集群中不存在Leader情况下则会相对复杂，其步骤如下。</p><h5 id="第一次投票"><a href="#第一次投票" class="headerlink" title="第一次投票"></a>第一次投票</h5><p>无论哪种导致进行Leader选举，集群的所有机器都处于试图选举出一个Leader的状态，即LOOKING状态，LOOKING机器会向所有其他机器发送消息，该消息称为投票。投票中包含了SID（服务器的唯一标识）和ZXID（事务ID），以(SID, ZXID)二元组形式来标识一次投票信息。</p><p>举例：假定Zookeeper由5台机器组成，SID分别为1、2、3、4、5，ZXID分别为9、9、9、8、8，并且此时SID为2的机器是Leader机器，某一时刻，1、2所在机器出现故障，因此集群开始进行Leader选举。在第一次投票时，每台机器都会将自己作为投票对象，于是SID为3、4、5的机器投票情况分别为(3, 9)，(4, 8)， (5, 8)。</p><h5 id="变更投票"><a href="#变更投票" class="headerlink" title="变更投票"></a>变更投票</h5><p>每台机器发出投票后，也会收到其他机器的投票，每台机器会根据一定规则来处理收到的其他机器的投票，并以此来决定是否需要变更自己的投票，这个规则也是整个Leader选举算法的核心所在，其中术语描述如下</p><ul><li><p>vote_sid：接收到的投票中所推举Leader服务器的SID。</p></li><li><p>vote_zxid：接收到的投票中所推举Leader服务器的ZXID。</p></li><li><p>self_sid：当前服务器自己的SID。</p></li><li><p>self_zxid：当前服务器自己的ZXID。</p></li></ul><p>每次对收到的投票的处理，都是对(vote_sid, vote_zxid)和(self_sid, self_zxid)对比的过程。</p><p>​ 规则一：如果vote_zxid大于self_zxid，就认可当前收到的投票，并再次将该投票发送出去。</p><p>​ 规则二：如果vote_zxid小于self_zxid，那么坚持自己的投票，不做任何变更。</p><p>​ 规则三：如果vote_zxid等于self_zxid，那么就对比两者的SID，如果vote_sid大于self_sid，那么就认可当前收到的投票，并再次将该投票发送出去。</p><p>​ 规则四：如果vote_zxid等于self_zxid，并且vote_sid小于self_sid，那么坚持自己的投票，不做任何变更。</p><p>结合上面规则，给出下面的集群变更过程。</p><table><thead><tr><th>服务器/ 时间周期</th><th>出现故障时</th><th>第一次投票</th><th>变更投票</th><th>确定LEADER</th></tr></thead><tbody><tr><td>Server1</td><td>出现故障</td><td>\</td><td>\</td><td>\</td></tr><tr><td>Server2</td><td>出现故障</td><td>\</td><td>\</td><td>\</td></tr><tr><td>Server3</td><td>leader挂了，服务不可用，状态变更为LOOKING</td><td>投票（3，9）</td><td>收到两个投票（4，8）、（5，8），不变更投票。</td><td>收到两个投票（3，9），确定Server3为LEADER，变更状态为LEADING。</td></tr><tr><td>Server4</td><td>leader挂了，服务不可用，状态变更为LOOKING</td><td>投票（4，8）</td><td>收到两个投票（3，9）、（5，8），变更投票，投票（3，9）</td><td>收到两个投票（3，9），确定Server3为LEADER，变更状态为FOLLOWING。</td></tr><tr><td>Server5</td><td>leader挂了，服务不可用，状态变更为LOOKING</td><td>投票（5，8）</td><td>收到两个投票（3，9）、（5，8），变更投票，投票（3，9）</td><td>收到两个投票（3，9），确定Server3为LEADER，变更状态为FOLLOWING。</td></tr></tbody></table><p>(3) <strong>确定Leader</strong>。经过第二轮投票后，集群中的每台机器都会再次接收到其他机器的投票，然后开始统计投票，如果一台机器收到了超过半数的相同投票，那么这个投票对应的SID机器即为Leader。此时Server3将成为Leader。</p><p>由上面规则可知，通常那台服务器上的数据越新（ZXID会越大），其成为Leader的可能性越大，也就越能够保证数据的恢复。如果ZXID相同，则SID越大机会越大。</p><h4 id="选举实现细节"><a href="#选举实现细节" class="headerlink" title="选举实现细节"></a>选举实现细节</h4><h5 id="服务器状态"><a href="#服务器状态" class="headerlink" title="服务器状态"></a>服务器状态</h5><p>一台服务器具有四种状态，分别是LOOKING、FOLLOWING、LEADING、OBSERVING。</p><ol><li><p>LOOKING：寻找Leader状态。当服务器处于该状态时，它会认为当前集群中没有Leader，因此需要进入Leader选举状态。</p></li><li><p>FOLLOWING：跟随者状态。表明当前服务器角色是Follower。</p></li><li><p>LEADING：领导者状态。表明当前服务器角色是Leader。</p></li><li><p>OBSERVING：观察者状态。表明当前服务器角色是Observer。</p></li></ol><h5 id="投票数据结构"><a href="#投票数据结构" class="headerlink" title="投票数据结构"></a>投票数据结构</h5><p>每个投票中包含了两个最基本的信息，所推举服务器的SID和ZXID，投票（Vote）在Zookeeper中包含字段如下：</p><ul><li><p>id：被推举的Leader的SID。</p></li><li><p>zxid：被推举的Leader事务ID。</p></li><li><p>electionEpoch：逻辑时钟，用来判断多个投票是否在同一轮选举周期中，该值在服务端是一个自增序列，每次进入新一轮的投票后，都会对该值进行加1操作。</p></li><li><p>peerEpoch：被推举的Leader的epoch。</p></li><li><p>state：当前服务器的状态。</p></li></ul><h5 id="QuorumCnxManager（网络I-O）"><a href="#QuorumCnxManager（网络I-O）" class="headerlink" title="QuorumCnxManager（网络I/O）"></a>QuorumCnxManager（网络I/O）</h5><p>每台服务器在启动的过程中，会启动一个QuorumPeerManager，负责各台服务器之间的底层Leader选举过程中的网络通信。</p><h6 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h6><p>QuorumCnxManager内部维护了一系列的队列，用来保存接收到的、待发送的消息以及消息的发送器，除接收队列以外，其他队列都按照SID分组形成队列集合，如一个集群中除了自身还有3台机器，那么就会为这3台机器分别创建一个发送队列，互不干扰。</p><ul><li>recvQueue：消息接收队列，用于存放那些从其他服务器接收到的消息。</li><li>queueSendMap：消息发送队列，用于保存那些待发送的消息，按照SID进行分组。</li><li>senderWorkerMap：发送器集合，每个SenderWorker消息发送器，都对应一台远程Zookeeper服务器，负责消息的发送，也按照SID进行分组。</li><li>lastMessageSent： 最近发送过的消息，为每个SID保留最近发送过的一个消息。</li></ul><h6 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h6><p>为了能够相互投票，Zookeeper集群中的所有机器都需要两两建立起网络连接。QuorumCnxManager在启动时会创建一个ServerSocket来监听Leader选举的通信端口(默认为3888)。开启监听后，Zookeeper能够不断地接收到来自其他服务器的创建连接请求，在接收到其他服务器的TCP连接请求时，会进行处理。为了避免两台机器之间重复地创建TCP连接，Zookeeper只允许SID大的服务器主动和其他机器建立连接，否则断开连接。在接收到创建连接请求后，服务器通过对比自己和远程服务器的SID值来判断是否接收连接请求，如果当前服务器发现自己的SID更大，那么会断开当前连接，然后自己主动和远程服务器建立连接。一旦连接建立，就会根据远程服务器的SID来创建相应的消息发送器SendWorker和消息接收器RecvWorker，并启动。</p><h6 id="消息接收与发送"><a href="#消息接收与发送" class="headerlink" title="消息接收与发送"></a>消息接收与发送</h6><p>消息接收：由消息接收器RecvWorker负责，由于Zookeeper为每个远程服务器都分配一个单独的RecvWorker，因此，每个RecvWorker只需要不断地从这个TCP连接中读取消息，并将其保存到recvQueue队列中。<strong>消息发送</strong>：由于Zookeeper为每个远程服务器都分配一个单独的SendWorker，因此，每个SendWorker只需要不断地从对应的消息发送队列中获取出一个消息发送即可，同时将这个消息放入lastMessageSent中。在SendWorker中，一旦Zookeeper发现针对当前服务器的消息发送队列为空，那么此时需要从lastMessageSent中取出一个最近发送过的消息来进行再次发送，这是为了解决接收方在消息接收前或者接收到消息后服务器挂了，导致消息尚未被正确处理。同时，Zookeeper能够保证接收方在处理消息时，会对重复消息进行正确的处理。</p><h5 id="FastLeaderElection：选举算法核心"><a href="#FastLeaderElection：选举算法核心" class="headerlink" title="FastLeaderElection：选举算法核心"></a>FastLeaderElection：选举算法核心</h5><p><strong>· 外部投票</strong>：特指其他服务器发来的投票。</p><p><strong>· 内部投票</strong>：服务器自身当前的投票。</p><p><strong>· 选举轮次</strong>：Zookeeper服务器Leader选举的轮次，即logicalclock。</p><p><strong>· PK</strong>：对内部投票和外部投票进行对比来确定是否需要变更内部投票。</p><h6 id="选票管理"><a href="#选票管理" class="headerlink" title="选票管理"></a>选票管理</h6><p><strong>· sendqueue</strong>：选票发送队列，用于保存待发送的选票。</p><p><strong>· recvqueue</strong>：选票接收队列，用于保存接收到的外部投票。</p><p><strong>· WorkerReceiver</strong>：选票接收器。其会不断地从QuorumCnxManager中获取其他服务器发来的选举消息，并将其转换成一个选票，然后保存到recvqueue中，在选票接收过程中，如果发现该外部选票的选举轮次小于当前服务器的，那么忽略该外部投票，同时立即发送自己的内部投票。</p><p>　<strong>· WorkerSender</strong>：选票发送器，不断地从sendqueue中获取待发送的选票，并将其传递到底层QuorumCnxManager中。</p><p>(2) 算法核心</p><p><img src="https://i.loli.net/2021/04/11/yFnxRhaCUzpSvPl.png" alt="img"></p><p>上图展示了FastLeaderElection模块是如何与底层网络I/O进行交互的。Leader选举的基本流程如下</p><ol><li><p><strong>自增选举轮次</strong>。Zookeeper规定所有有效的投票都必须在同一轮次中，在开始新一轮投票时，会首先对logicalclock进行自增操作。</p></li><li><p><strong>初始化选票</strong>。在开始进行新一轮投票之前，每个服务器都会初始化自身的选票，并且在初始化阶段，每台服务器都会将自己推举为Leader。</p></li><li><p><strong>发送初始化选票</strong>。完成选票的初始化后，服务器就会发起第一次投票。Zookeeper会将刚刚初始化好的选票放入sendqueue中，由发送器WorkerSender负责发送出去。</p></li><li><p><strong>接收外部投票</strong>。每台服务器会不断地从recvqueue队列中获取外部选票。如果服务器发现无法获取到任何外部投票，那么就会立即确认自己是否和集群中其他服务器保持着有效的连接，如果没有连接，则马上建立连接，如果已经建立了连接，则再次发送自己当前的内部投票。</p></li></ol><p>　5. <strong>判断选举轮次</strong>。在发送完初始化选票之后，接着开始处理外部投票。在处理外部投票时，会根据选举轮次来进行不同的处理。</p><p><strong>· 外部投票的选举轮次大于内部投票</strong>。若服务器自身的选举轮次落后于该外部投票对应服务器的选举轮次，那么就会立即更新自己的选举轮次(logicalclock)，并且清空所有已经收到的投票，然后使用初始化的投票来进行PK以确定是否变更内部投票。最终再将内部投票发送出去。</p><p><strong>· 外部投票的选举轮次小于内部投**</strong>票**。若服务器接收的外选票的选举轮次落后于自身的选举轮次，那么Zookeeper就会直接忽略该外部投票，不做任何处理，并返回步骤4。</p><p><strong>· 外部投票的选举轮次等于内部投票</strong>。此时可以开始进行选票PK。</p><ol start="6"><li><strong>选票PK</strong>。在进行选票PK时，符合任意一个条件就需要变更投票。</li></ol><p>　　　　· 若外部投票中推举的Leader服务器的选举轮次大于内部投票，那么需要变更投票。</p><p>　　　　· 若选举轮次一致，那么就对比两者的ZXID，若外部投票的ZXID大，那么需要变更投票。</p><p>　　　　· 若两者的ZXID一致，那么就对比两者的SID，若外部投票的SID大，那么就需要变更投票。</p><ol start="7"><li><p><strong>变更投票</strong>。经过PK后，若确定了外部投票优于内部投票，那么就变更投票，即使用外部投票的选票信息来覆盖内部投票，变更完成后，再次将这个变更后的内部投票发送出去。</p></li><li><p><strong>选票归档</strong>。无论是否变更了投票，都会将刚刚收到的那份外部投票放入选票集合recvset中进行归档。recvset用于记录当前服务器在本轮次的Leader选举中收到的所有外部投票（按照服务队的SID区别，如{(1, vote1), (2, vote2)…}）。</p></li><li><p><strong>统计投票</strong>。完成选票归档后，就可以开始统计投票，统计投票是为了统计集群中是否已经有过半的服务器认可了当前的内部投票，如果确定已经有过半服务器认可了该投票，则终止投票。否则返回步骤4。</p></li><li><p><strong>更新服务器状态</strong>。若已经确定可以终止投票，那么就开始更新服务器状态，服务器首选判断当前被过半服务器认可的投票所对应的Leader服务器是否是自己，若是自己，则将自己的服务器状态更新为LEADING，若不是，则根据具体情况来确定自己是FOLLOWING或是OBSERVING。</p></li></ol><p>　　以上10个步骤就是FastLeaderElection的核心，其中步骤4-9会经过几轮循环，直到有Leader选举产生。</p><p><strong>三、总结</strong></p><p>​ gaoshan个人解释，选举轮次，也就是逻辑时钟，即logicalclock。这个值，不会频繁变化，一次选举，自增一次。一次选举过程中，可能包括多次投票，投票不涉及逻辑时钟的自增。</p><p>​ 举例，初始情况下5台机器，sid分别为1、2、3、4、5，逻辑时钟都是0。依次启动后，开始选举，所有的机器逻辑时钟自增为1。经过多次投票，假设第三台机器为leader，其他4台机器为follower，此时5台机器的逻辑时钟都为1。</p><p>​ 一般情况下，逻辑时钟应该都是相同的。但是，由于一些机器崩溃的问题，是可能出现逻辑时钟不一致的情况的。例如，上例中，sid=3的机器为leader。之后某一刻，sid为1、3的机器崩溃，zookeeper仍然可以正常对外提供服务。但需要重新选主，剩下的2、4、5重新投票选主，假设sid=5成为新的leader，逻辑时钟自增，由1变成2。之后某一刻，sid为5的机器奔溃，sid为1的机器复活，仍然有3台机器运行，zookeeper可以对外提供服务，但需要重新选主。重新选主，逻辑时钟自增，这时sid为2、4的机器的逻辑时钟是由2自增为3，而sid为1的机器的逻辑时钟是由1自增为2。这种情况下，就出现了逻辑时钟不一致的情况。这时，需要清楚sid为1的机器内部的投票数据，因为这些投票数据都是过时的数据。</p><blockquote><blockquote><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c2ced54736aa">https://www.jianshu.com/p/c2ced54736aa</a></p></blockquote></blockquote><p>服务器启动过程</p><p><img src="https://i.loli.net/2021/04/11/IOryTNFlBdHnquV.png" alt="image-20210411231957113"></p><pre><code>mermaid
stateDiagram-v2
    [*] --&gt; 处于LOOKING状态: 服务器节点启动
    处于LOOKING状态 --&gt; 存在LEADER: 查找LEADER
    存在LEADER --&gt; 变更状态为LEADING或FOLLOWING: YES，变更状态为FOLLOWING
    存在LEADER --&gt; 选举LEADER: NO
    选举LEADER --&gt; 选举获胜
    选举获胜 --&gt; 变更状态为LEADING或FOLLOWING: YES，变更状态为LEADING
    选举获胜 --&gt; 变更状态为LEADING或FOLLOWING: NO，变更状态为FOLLOWING
    变更状态为LEADING或FOLLOWING --&gt; [*]
</code></pre><p>选举过程</p><p><img src="https://i.loli.net/2021/04/11/FhQAjvpoid7gC1D.png" alt="image-20210411232131334"></p><pre><code>mermaid
stateDiagram-v2
    [*] --&gt; 处于LOOKING状态: 变更状态为LOOKING
    处于LOOKING状态 --&gt; 存在LEADER: 查找LEADER
    存在LEADER --&gt; 变更状态为LEADING或FOLLOWING: YES，变更状态为FOLLOWING
    存在LEADER --&gt; 收到投票: NO，进行投票，并且投票给自己
    收到投票 --&gt; 投票给自己: 自己的zxid是最大的，或zxid相同，自己的myid最大
    收到投票 --&gt; 投给别人: 别人的zxid更大的，或者zxid相同，别人的myid更大
    投票给自己 --&gt; 统计投票
    投给别人 --&gt; 统计投票
    统计投票 --&gt; 变更状态为LEADING或FOLLOWING: 超过半数机器投相同的票
    统计投票 --&gt; 继续投票: 没有超过半数机器投相同的票
    继续投票 --&gt;  投票给自己: 自己的zxid是最大的，或zxid相同，自己的myid最大
    继续投票 --&gt; 投给别人: 别人的zxid更大的，或者zxid相同，别人的myid更大
    变更状态为LEADING或FOLLOWING --&gt; [*]
</code></pre><h3 id="五、补充"><a href="#五、补充" class="headerlink" title="五、补充"></a>五、补充</h3><h4 id="ZXID"><a href="#ZXID" class="headerlink" title="ZXID"></a>ZXID</h4><p>集群范围内，全局单调唯一递增； ZXID是一个64位的数字，低32代表一个单调递增的计数器，高32位代表Leader周期。</p><h4 id="ZXID变化"><a href="#ZXID变化" class="headerlink" title="ZXID变化"></a><strong>ZXID变化</strong></h4><ul><li>当有新的Leader产生时，Leader周期epoch加1，计数器从0开始；</li><li>每处理一个事务请求，计数器加1；</li></ul></div></div><nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col"><a href="/2021/03/09/CAP%E7%90%86%E8%AE%BA/" id="post_nav-newer" class="prev-content"><button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_back</i></button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 新篇</a><div class="section-spacer"></div><a href="/2021/02/19/%E7%B1%BB%E9%94%81%E5%92%8C%E5%AF%B9%E8%B1%A1%E9%94%81/" id="post_nav-older" class="next-content">旧篇 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_forward</i></button></a></nav></div></div><div class="sidebar-overlay"></div><aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation"><div id="sidebar-main"><div class="sidebar-header header-cover" style="background-image:url(/img/sidebar_header.png)"><div class="top-bar"></div><button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display:initial" data-upgraded=",MaterialButton,MaterialRipple"><i class="material-icons">clear_all</i> <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button><div class="sidebar-image"><img src="/img/avatar.jpg" alt="小明's avatar"></div><a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">huanmingcn@gmail.com <b class="caret"></b></a></div><ul class="nav sidebar-nav"><li class="dropdown"><ul id="settings-dropdown" class="dropdown-menu"><li><a href="mailto:huanmingcn@gmail.com" target="_blank" title="Email Me"><i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i> Email Me</a></li></ul></li><li id="sidebar-first-li"><a href="/"><i class="material-icons sidebar-material-icons">home</i> 主页</a></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">inbox</i> 归档 <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/archives/2023/11/">十一月 2023<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2023/10/">十月 2023<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2023/09/">九月 2023<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/04/">四月 2021<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/02/">二月 2021<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">3</span></a></li></ul></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">chrome_reader_mode</i> 分类 <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/categories/Hexo/">Hexo<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/JVM/">JVM<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/SPI/">SPI<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Zookeeper/">Zookeeper<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/nginx/">nginx<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA/">分布式理论<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/">名词解释<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E7%A4%BE%E5%8C%BA%E8%B4%A1%E7%8C%AE/">社区贡献<span class="sidebar_archives-count">1</span></a></li></ul></li></ul><div class="sidebar-divider"></div><a href="https://github.com/viosey/hexo-theme-material" class="sidebar-footer-text-a" target="_blank"><div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">主题 - Material <span class="sidebar-badge badge-circle">i</span></div></a></div></aside><div id="back-to-top" class="toTop-wrap"><a href="#top" class="toTop"><i class="material-icons footer_top-i">expand_less</i></a></div><footer class="mdl-mini-footer" id="bottom"><div class="mdl-mini-footer--left-section sns-list"></div><div id="copyright">Copyright&nbsp;©<script type="text/javascript">var fd=new Date;document.write("&nbsp;"+fd.getFullYear()+"&nbsp;")</script>小明的博客</div><div class="mdl-mini-footer--right-section"><div><div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div><div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div></div></div></footer><script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==",!0)</script><script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==",!0)</script><script>lsloader.load("np_js","https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js",!0)</script><script type="text/ls-javascript" id="NProgress-script">NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);</script><script>var agent=navigator.userAgent.toLowerCase();0<agent.indexOf("ucbrowser")&&(document.write('<link rel="stylesheet" href="/css/uc.css">'),alert("由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。"))</script><script>lsloader.load("prettify_js","https://lib.baomitu.com/prettify/188.0.0/prettify.min.js",!0)</script><script type="text/ls-javascript" id="window-load">$(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })</script><script type="text/ls-javascript" id="lazy-load">// Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });</script><script>!function(){for(var e=document.querySelectorAll('script[type="text/ls-javascript"]'),r=0;r<e.length;++r){var o=e[r];lsloader.runInlineScript(o.id,o.id)}}(),console.log("\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n","color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;","color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;")</script></main></div><script></script></body></html>